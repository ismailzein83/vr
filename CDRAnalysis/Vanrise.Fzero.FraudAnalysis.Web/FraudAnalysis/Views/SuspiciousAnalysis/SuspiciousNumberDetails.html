<div vr-modalcontent draggable ng-controller="FraudAnalysis_SuspiciousNumberDetailsController" width="'95%'">
    <vr-modalbody vr-loader="isLoading" maxheight="'600px'">

        <vr-form name="formSuspiciousNumberDetails">

            <vr-row>
                <vr-columns width="normal">
                    <vr-label>Account Number: </vr-label>
                    <vr-label isvalue>{{accountNumber}}</vr-label>
                </vr-columns>

                <vr-columns width="normal">
                    <vr-label>Account Status: </vr-label>
                    <vr-label isvalue color="{{getCaseStatusColor({ StatusID: status })}}">{{accountStatusDescription}}</vr-label>
                </vr-columns>
            </vr-row>

            <vr-choices selectedindex="selectedTabIndex" onselectionchanged="onSelectedTabChanged()">
                <vr-choice isselected="occurancesSelected">Current Occurrences</vr-choice>
                <vr-choice isselected="cdrsSelected">CDRs</vr-choice>
                <vr-choice isselected="numberProfilesSelected">Number Profiles</vr-choice>
                <vr-choice isselected="caseHistorySelected">Case History</vr-choice>
                <vr-choice isselected="relatedNumbersSelected" ng-show="showRelatedNumbers">Related Numbers</vr-choice>
            </vr-choices>

            <div ng-show="occurancesSelected">
                <vr-row>

                    <vr-columns width="fullrow" ng-show="showOccurancesGrid">
                        <vr-datagrid datasource="occurances"
                                     on-ready="onGridReady_Occurances"
                                     dataretrievalfunction="dataRetrievalFunction_Occurances"
                                     pagingtype="'PagingOnScroll'"
                                     maxheight="150px"
                                     idfield="DetialID">
                            <vr-datagridcolumn headertext="'Id'" field="'StrategyExecutionId'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Suspicion Level'" field="'SuspicionLevelDescription'" type="'Text'" getcolor="getSuspicionLevelColor"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Strategy'" field="'StrategyName'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'From Time'" field="'FromDate'" type="'Datetime'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'To Time'" field="'ToDate'" type="'Datetime'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Execution Time'" field="'ExecutionDate'" type="'Datetime'"></vr-datagridcolumn>
                        </vr-datagrid>
                    </vr-columns>
                </vr-row>
                <vr-row>
                    <vr-columns width="fullrow">
                        {{ message }}
                    </vr-columns>
                </vr-row>
            </div>

            <div ng-show="cdrsSelected">
                <vr-form validationcontext="searchCDRsContext">
                    <vr-row>
                        <vr-columns width="normal">
                            <vr-datetimepicker label="From" value="fromDate_CDRs" type="dateTime" isrequired customvalidate="validateTimeRangeCDRs()"></vr-datetimepicker>
                        </vr-columns>

                        <vr-columns width="normal">
                            <vr-datetimepicker label="To" value="toDate_CDRs" type="dateTime" customvalidate="validateTimeRangeCDRs()"></vr-datetimepicker>
                        </vr-columns>
                        <vr-columns withemptyline width="1/4row">
                            <vr-button type="Search" data-onclick="searchCDRs" standalone validationcontext="searchCDRsContext"></vr-button>
                        </vr-columns>
                    </vr-row>
                </vr-form>
                <vr-row>
                    <vr-columns width="fullrow" simplecol>
                        <vr-datagrid datasource="cdrs"
                                     on-ready="onGridReady_CDRs"
                                     dataretrievalfunction="dataRetrievalFunction_CDRs"
                                     pagingtype="'PagingOnScroll'"
                                     maxheight="150px">

                            <vr-datagridcolumn headertext="'IMSI'" field="'Entity.IMSI'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Connect Time'" field="'Entity.ConnectDateTime'" type="'Datetime'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Destination'" field="'Entity.Destination'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Duration (sec)'" field="'Entity.DurationInSeconds'" type="'Number'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Call Class'" field="'CallClassName'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Call Type'" field="'CallTypeName'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Subscriber Type'" field="'SubscriberTypeName'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'IMEI'" field="'Entity.IMEI'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Cell'" field="'Entity.Cell'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Up Volume'" field="'Entity.UpVolume'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Down Volume'" field="'Entity.DownVolume'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Service VAS Name'" field="'Entity.ServiceVASName'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Release Code'" field="'Entity.ReleaseCode'" type="'Text'"></vr-datagridcolumn>

                        </vr-datagrid>
                    </vr-columns>
                </vr-row>
            </div>

            <div ng-show="numberProfilesSelected">
                <vr-validation-group validationcontext="searchNumberProfileContext">
                    <vr-row>
                        <vr-columns width="normal" ng-show="showProfileOptions">
                            <vr-select label="Profile Source"
                                       datasource="profileSources"
                                       selectedvalues="selectedProfileSource"
                                       datavaluefield="value"
                                       datatextfield="description"
                                       onselectionchanged="onProfileSourceChanged"
                                       hideremoveicon>
                            </vr-select>
                        </vr-columns>

                        <vr-columns width="normal">
                            <vr-datetimepicker label="From"
                                               value="fromDate_NumberProfiles"
                                               type="dateTime"
                                               isrequired
                                               ng-show="showDate"
                                               customvalidate="validateTimeRangeNumberProfiles()">
                            </vr-datetimepicker>
                        </vr-columns>

                        <vr-columns width="normal">
                            <vr-datetimepicker label="To"
                                               value="toDate_NumberProfiles"
                                               type="dateTime"
                                               ng-show="showDate"
                                               customvalidate="validateTimeRangeNumberProfiles()">
                            </vr-datetimepicker>
                        </vr-columns>
                        <vr-columns withemptyline width="normal" ng-if="showDate">
                            <vr-button type="Search" data-onclick="searchNumberProfiles" standalone validationcontext="searchNumberProfileContext"></vr-button>
                        </vr-columns>
                    </vr-row>
                </vr-validation-group>
                <vr-row>
                    <vr-columns width="fullrow">
                        <div class="big-data-grid" ng-hide="showDate">
                            <div class="container">
                                <vr-datagrid datasource="detailAggregateValues"
                                             maxheight="150px"
                                             hidegridmenu>
                                    <vr-datagridcolumn headertext="'From Time'" field="'FromDate'" type="'Datetime'" disablesorting></vr-datagridcolumn>
                                    <vr-datagridcolumn headertext="'To Time'" field="'ToDate'" type="'Datetime'" disablesorting></vr-datagridcolumn>

                                    <vr-datagridcolumn ng-repeat="agg in aggregateDefinitions"
                                                       headertext="agg.name"
                                                       field="'AggregateValues[&quot;' + agg.name + '&quot;]'"
                                                       type="'Number'"
                                                       numberprecision="agg.numberPrecision"
                                                       disablesorting>
                                    </vr-datagridcolumn>
                                </vr-datagrid>
                            </div>
                        </div>

                        <div class="big-data-grid" ng-show="showDate">
                            <div class="container">
                                <vr-datagrid datasource="numberProfile"
                                             on-ready="onGridReady_NumberProfiles"
                                             dataretrievalfunction="dataRetrievalFunction_NumberProfiles"
                                             pagingtype="'PagingOnScroll'"
                                             maxheight="150px"
                                             hidegridmenu>

                                    <vr-datagridcolumn headertext="'From Time'" field="'FromDate'" type="'Datetime'" disablesorting></vr-datagridcolumn>
                                    <vr-datagridcolumn headertext="'To Time'" field="'ToDate'" type="'Datetime'" disablesorting></vr-datagridcolumn>

                                    <vr-datagridcolumn ng-repeat="agg in aggregateDefinitions"
                                                       headertext="agg.name"
                                                       field="'AggregateValues[&quot;' + agg.name + '&quot;]'"
                                                       type="'Number'"
                                                       numberprecision="agg.numberPrecision"
                                                       disablesorting>
                                    </vr-datagridcolumn>
                                </vr-datagrid>
                            </div>
                        </div>
                    </vr-columns>
                </vr-row>
            </div>

            <div ng-show="caseHistorySelected">
                <vr-row>
                    <vr-columns width="fullrow">
                        <vr-datagrid datasource="cases"
                                     on-ready="onGridReady_CaseHistory"
                                     dataretrievalfunction="dataRetrievalFunction_CaseHistory"
                                     defaultsortbyfieldname="'CaseID'" defaultsortdirection="'DESC'"
                                     pagingtype="'PagingOnScroll'"
                                     maxheight="150px"
                                     idfield="CaseID">

                            <vr-datagridcolumn headertext="'Case ID'" field="'CaseID'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Status'" field="'CaseStatusDescription'" type="'Text'" getcolor="getCaseStatusColor"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Analyst'" field="'UserName'" type="'Text'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Create Time'" field="'CreatedTime'" type="'Datetime'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Status Update Time'" field="'StatusUpdatedTime'" type="'Datetime'"></vr-datagridcolumn>
                            <vr-datagridcolumn headertext="'Valid Till'" field="'ValidTill'" type="'Datetime'"></vr-datagridcolumn>

                            <vr-datagridexpandablerow>
                                <div ng-include="'/Client/Modules/FraudAnalysis/Views/SuspiciousAnalysis/Includes/CaseOccuranceGrid.html'"></div>
                            </vr-datagridexpandablerow>
                        </vr-datagrid>
                    </vr-columns>
                </vr-row>
            </div>

            <div ng-show="relatedNumbersSelected">
                <vr-row>
                    <vr-columns width="normal">
                        <vr-select label="Reason"
                                   datasource="reasons"
                                   selectedvalues="selectedReason"
                                   datavaluefield="value"
                                   datatextfield="description"
                                   onselectionchanged="onReasonChanged"
                                   hideremoveicon>
                        </vr-select>
                    </vr-columns>
                </vr-row>
                <vr-row>
                    <vr-columns width="fullrow" simplecol>
                        <vr-datagrid datasource="relatedNumbers"
                                     data-on-ready="onGridReady_RelatedNumbers"
                                     maxheight="150px"
                                     hidegridmenu>

                            <vr-datagridcolumn headertext="'Related Number'" field="'RelatedNumber'" type="'Text'" isclickable="true" onclicked="relatedNumberClicked" disablesorting></vr-datagridcolumn>
                        </vr-datagrid>
                    </vr-columns>
                </vr-row>
            </div>

            <vr-row>
                <vr-columns width="fullrow">
                    <vr-validation-group validationcontext="updateCaseContext">
                        <vr-section title="Update Case">
                            <vr-row>
                                <vr-columns width="normal">
                                    <vr-select label="Status"
                                               datasource="caseStatuses"
                                               selectedvalues="selectedCaseStatus"
                                               datavaluefield="value"
                                               datatextfield="description"
                                               onselectionchanged="toggleValidTill"
                                               isrequired>
                                    </vr-select>
                                </vr-columns>

                                <vr-columns width="normal" ng-show="whiteListSelected">
                                    <vr-datetimepicker label="Valid Till"
                                                       value="validTill"
                                                       type="dateTime">
                                    </vr-datetimepicker>
                                </vr-columns>
                            </vr-row>
                            <vr-row>
                                <vr-columns width="fullrow">
                                    <vr-textarea label="Reason" value="updateReason"></vr-textarea>
                                </vr-columns>
                            </vr-row>
                        </vr-section>
                    </vr-validation-group>
                </vr-columns>
            </vr-row>

        </vr-form>
    </vr-modalbody>
    <div>
        <vr-actionbar showcollapsebutton="false" issectioncollapsed="false">
            <div transclude-to="buttons">
                <vr-button type="Save" validationcontext="updateCaseContext" data-onclick="updateAccountCase" haspermission="hasUpdateAccountCasePermission"></vr-button>
                <vr-button type="Close" data-onclick="close"></vr-button>
            </div>
        </vr-actionbar>
    </div>
</div>
